!function(e){function t(t){for(var s,o,r=t[0],l=t[1],c=t[2],d=0,m=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&m.push(i[o][0]),i[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);for(u&&u(t);m.length;)m.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],s=!0,r=1;r<n.length;r++){var l=n[r];0!==i[l]&&(s=!1)}s&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var s={},i={0:0},a=[];function o(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=s,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;a.push([121,1]),n()}({121:function(e,t,n){n(122),e.exports=n(310)},309:function(e,t){e.exports='<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>Gem puzzle</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="preconnect" href="https://fonts.gstatic.com"> <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet"> </head> <body></body> </html>'},310:function(e,t,n){"use strict";n.r(t);n(309);var s={getElements:function(){return this.elements},getElementsByConfig:function(e){var t=this,n=null;return Object.keys(e).forEach((function(s){var i=e[s];if(!i.skip)if(i.container)n.append(t.getElementsByConfig(i));else{var a=document.createElement(i.tag||"div");i.el=a,function(e,t){e.className=t.class,t.text&&(e.innerText=t.text),t.template&&(e.innerHTML=t.template),t.click&&e.addEventListener("click",t.click),t.change&&e.addEventListener("change",t.change)}(a,i),"container"===s?n=a:n.append(a)}})),n},getFullDateFromTimestamp:function(e){var t=new Date(e),n=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),a=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(s,"-").concat(i," ").concat(a,":").concat(o,":").concat(r)}};function i(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function o(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,s),this.$app=t,this.id=Math.random(),this.loadedData=null,this.grid=[],this.gridInitial=[],this.gridElements=[],this.gridElementExample={id:null,element:null},this.stats=this.getStatsProxy({minutes:0,seconds:0,steps:0}),this.elements={container:{class:"puzzle__game",el:null,modifiers:{draggable:"puzzle__game--draggable"}},grid:{container:{class:"puzzle__game-grid",el:null,modifiers:{"container-9":"puzzle__game-grid--grid9","container-16":"puzzle__game-grid--grid16","container-25":"puzzle__game-grid--grid25","container-36":"puzzle__game-grid--grid36","container-49":"puzzle__game-grid--grid49","container-64":"puzzle__game-grid--grid64"}},item:{class:"puzzle__game-grid-item"},button:{class:"puzzle__game-grid-item-button",modifiers:{active:"puzzle__game-grid-item-button--active",inactive:"puzzle__game-grid-item-button--inactive",draggable:"puzzle__game-grid-item-button--draggable"}}},stats:{container:{class:"puzzle__game-stats",el:null},time:{class:"puzzle__game-stats-time",el:null,text:"Time:"},steps:{class:"puzzle__game-stats-steps",el:null,text:"Steps:"}}},this.audio=new(window.AudioContext||window.webkitAudioContext),this.sounds={snap:{src:"assets/sounds/snap.mp3",buffer:null}},this.imageNumber=null,this.imageParts=[],this.isBuilded=!1,this.isMoving=!1,this.isActive=!1,this.isGameEnded=!1,this.loadSounds()}var t,n,a;return t=e,(n=[{key:"getRandomGrid",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&t.length){var n=0;return this.grid.length=0,t.forEach((function(t){e.grid.push(t),n+=t.length})),void(this.gridInitial=this.getGridInitialByLength(n))}var s=this.getGridInitialByLength(this.$app.config.columns*this.$app.config.rows);this.grid.length=0,this.gridInitial=Array.from(s);for(var i=0;i<this.$app.config.rows;i++){for(var a=[],o=0;o<this.$app.config.columns;o++){var r=Math.floor(Math.random()*s.length);a.push(s[r]),s.splice(r,1)}this.grid.push(a)}this.isGridSolvable(this.getGridAsArray())||this.getRandomGrid()}},{key:"getGridAsArray",value:function(){return this.grid.reduce((function(e,t){return e.push.apply(e,i(t)),e}),[])}},{key:"getGridInitialByLength",value:function(e){var t=i(new Array(e).keys());return t.shift(),t.push(0),t}},{key:"isGridSolvable",value:function(e){for(var t=0,n=1,s=e.length-1;n<s;n++)for(var i=n-1;i>=0;i--)e[i]>e[n]&&t++;return!(t%2)}},{key:"buildGameContainer",value:function(){this.elements.container.el=document.createElement("div"),this.elements.container.el.className=this.elements.container.class,this.buildControlsContainer(),this.buildGridContainer(),this.$app.appendToMainContainer(this.elements.container.el)}},{key:"buildGridContainer",value:function(){var e=this;this.elements.grid.container.el=document.createElement("div"),this.elements.grid.container.el.className=this.elements.grid.container.class,this.elements.container.el.append(this.elements.grid.container.el),setTimeout((function(){e.setGridListeners()}))}},{key:"buildGridItems",value:function(e){var t=this;this.gridElements.length=0,this.elements.grid.container.el.innerHTML="",this.getRandomGrid(e),this.getGridAsArray().forEach((function(e){var n=t.generateGridItem(e);t.gridElements.push(n),t.elements.grid.container.el.append(n.element.parentNode)})),this.sortGridElements()}},{key:"generateGridItem",value:function(e){var t=JSON.parse(JSON.stringify(this.gridElementExample)),n=document.createElement("div");n.className=this.elements.grid.item.class;var s=document.createElement("div");return s.innerText=e?e.toString():"",this.$app.config.imagesInsteadNumbers&&e&&(s=this.imageParts[e]),s.className=this.elements.grid.button.class,e||s.classList.add(this.elements.grid.button.modifiers.inactive),n.append(s),t.id=e,t.element=s,t}},{key:"setGridListeners",value:function(){var e=this;this.elements.grid.container.el.addEventListener("mousedown",(function(t){if(!e.isGameEnded&&!e.isMoving){var n=t.target;n.classList.contains(e.elements.grid.item.class)&&(n=n.querySelector(".".concat(e.elements.grid.button.class)));var s=e.getElementConfigByNode(n);if(s&&n.classList.contains(e.elements.grid.button.modifiers.active)){e.isActive||(e.isActive=!0,e.startListenGameTime());var i={element:n,coords:e.getElementCoordinatesAbsolute(n),mouse:{x:t.x,y:t.y}},a=e;i.element.ontransitionend=function(t){t.target.classList.remove(e.elements.grid.button.modifiers.draggable),setTimeout((function(){e.isMoving=!1})),e.handleSuccessEnd(),t.target.ontransitionend=null};var o,r=(o=null,function(t){o&&(clearTimeout(o),o=null),o=setTimeout((function(){n.call(a,t),o=null}));var n=function(t){if(!(Math.abs(i.mouse.x-t.x)<25&&Math.abs(i.mouse.y-t.y)<25)){a.elements.container.el.classList.add(a.elements.container.modifiers.draggable),a.isMoving=!0;var n={x:t.x-i.coords.left-(i.coords.right-i.coords.left)/2,y:t.y-i.coords.top-(i.coords.bottom-i.coords.top)/2};i.element.style.transition="unset",i.element.style.transform="translate(".concat(n.x,"px, ").concat(n.y,"px)"),i.element.classList.add(e.elements.grid.button.modifiers.draggable)}}});document.addEventListener("mousemove",r),document.addEventListener("mouseup",(function t(n){setTimeout((function(){e.elements.container.el.classList.remove(e.elements.container.modifiers.draggable),setTimeout((function(){if(n.target.classList.contains(e.elements.grid.button.modifiers.inactive)){var t=e.getElementConfigByNode(n.target),a=e.getElementConfigByNode(i.element),o=e.getElementCoordinatesByID(t.id),r=e.getElementCoordinatesByID(a.id);e.moveElementTo(r,o)}e.isMoving||e.moveElementTo(e.getElementCoordinatesByID(s.id),e.getElementCoordinatesAvailable(s.id)),setTimeout((function(){i.element.removeAttribute("style")}))}))})),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",t)}))}}}))}},{key:"getElementCoordinatesByID",value:function(e){try{this.grid.forEach((function(t,n){t.forEach((function(t,s){if(t===e)throw new Error(JSON.stringify({x:s,y:n}))}))}))}catch(e){return JSON.parse(e.message)}}},{key:"getElementCoordinatesAvailable",value:function(e){var t=this.getElementCoordinatesByID(e);return this.grid[t.y]&&0===this.grid[t.y][t.x+1]?{x:t.x+1,y:t.y}:this.grid[t.y]&&0===this.grid[t.y][t.x-1]?{x:t.x-1,y:t.y}:this.grid[t.y+1]&&0===this.grid[t.y+1][t.x]?{x:t.x,y:t.y+1}:!(!this.grid[t.y-1]||0!==this.grid[t.y-1][t.x])&&{x:t.x,y:t.y-1}}},{key:"getElementCoordinatesAbsolute",value:function(e){return e.getBoundingClientRect()}},{key:"getElementConfigByNode",value:function(e){return this.gridElements.reduce((function(t,n){return n.element===e?n:t}),null)}},{key:"getNodeByCoordinates",value:function(e,t){return this.elements.grid.container.el.children[e+t*this.$app.config.rows].children[0]||null}},{key:"sortGridElements",value:function(){var e=this;this.grid.reduce((function(e,t){return e.push.apply(e,i(t)),e}),[]).forEach((function(t){var n=e.gridElements.find((function(e){return e.id===t})),s=e.getElementCoordinatesByID(t),i=e.getNodeByCoordinates(s.x,s.y);n.element.classList[e.isMoveAvailable(t)?"add":"remove"](e.elements.grid.button.modifiers.active),i!==n.element&&(e.switchNodes(n.element,e.getElementConfigByNode(i).element),e.isActive&&e.stats.steps++)}))}},{key:"isMoveAvailable",value:function(e){return!1!==this.getElementCoordinatesAvailable(e)}},{key:"moveElementTo",value:function(e,t){var n=this.grid[e.y][e.x];this.grid[e.y][e.x]=this.grid[t.y][t.x],this.grid[t.y][t.x]=n,this.sortGridElements()}},{key:"switchNodes",value:function(e,t){var n=this,s=e.parentNode,i=t.parentNode,a=this.getElementCoordinatesAbsolute(e),o=this.getElementCoordinatesAbsolute(t);s.innerHTML="",i.innerHTML="",s.append(t),i.append(e),e.style.transition="unset",e.classList.contains(this.elements.grid.button.modifiers.inactive)||(e.style.transform="translate(".concat(a.x-o.x,"px, ").concat(a.y-o.y,"px)")),t.style.transition="unset",t.classList.contains(this.elements.grid.button.modifiers.inactive)||(t.style.transform="translate(".concat(o.x-a.x,"px, ").concat(o.y-a.y,"px)")),setTimeout((function(){n.playSound(),e.removeAttribute("style"),t.removeAttribute("style")}))}},{key:"isGameComplete",value:function(){return JSON.stringify(this.gridInitial)===JSON.stringify(this.grid.reduce((function(e,t){return e.push.apply(e,i(t)),e}),[]))}},{key:"handleSuccessEnd",value:function(){var e=this;!this.isGameEnded&&this.isGameComplete()&&(this.isActive=!1,this.isGameEnded=!0,this.$app.storage.saveBestGames(),setTimeout((function(){alert("Ура! Вы решили головоломку за ".concat(e.getTimeString()," и ").concat(e.stats.steps," ходов"))})))}},{key:"startNewGame",value:function(){var e=this;this.isBuilded||(this.buildGameContainer(),this.isBuilded=!0),this.setGridContainerClass(this.$app.config.rows*this.$app.config.columns),this.elements.grid.container.el.style.transition="unset",this.elements.grid.container.el.style.opacity="0";var t=this.loadedData?this.loadedData.imageNumber:null;this.genImageParts((function(){e.loadedData?(e.buildGridItems(e.loadedData.grid),e.stats.minutes=e.loadedData.stats.minutes||0,e.stats.seconds=e.loadedData.stats.seconds||0,e.stats.steps=e.loadedData.stats.steps||0):(e.buildGridItems(),e.id=Math.random(),e.stats.minutes=0,e.stats.seconds=0,e.stats.steps=0),setTimeout((function(){e.elements.grid.container.el.removeAttribute("style")})),e.isMoving=!1,e.isActive=!1,e.isGameEnded=e.isGameComplete(),e.loadedData=null}),t)}},{key:"buildControlsContainer",value:function(){var e=this;this.elements.stats.container.el=document.createElement("div"),this.elements.stats.container.el.className=this.elements.stats.container.class,this.elements.container.el.append(this.elements.stats.container.el),Object.keys(this.elements.stats).forEach((function(t){"container"!==t&&(e.elements.stats[t].el=document.createElement("div"),e.elements.stats[t].el.className=e.elements.stats[t].class,e.elements.stats.container.el.append(e.elements.stats[t].el))}))}},{key:"getStatsProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,s){return e[n]=s,["minutes","seconds"].includes(n)?t.elements.stats.time.el.innerText="".concat(t.elements.stats.time.text," ").concat(t.getTimeString()):"steps"===n&&(t.elements.stats.steps.el.innerText="".concat(t.elements.stats.steps.text," ").concat(s.toString())),!0}})}},{key:"startListenGameTime",value:function(){var e=this;setTimeout((function(){e.isActive&&(e.stats.seconds++,60===e.stats.seconds&&(e.stats.minutes++,e.stats.seconds=0),e.startListenGameTime())}),1e3-(new Date).getMilliseconds())}},{key:"getTimeString",value:function(){return"".concat(this.stats.minutes.toString().padStart(2,"0"),":").concat(this.stats.seconds.toString().padStart(2,"0"))}},{key:"loadSounds",value:function(){var e=this,t=function(t){fetch(e.sounds[t].src).then((function(e){return e.arrayBuffer()})).then((function(n){return e.audio.decodeAudioData(n,(function(n){e.sounds[t].buffer=n}))}))};for(var n in this.sounds)t(n)}},{key:"playSound",value:function(){if(this.$app.config.isSoundAllowed){var e=this.audio.createBufferSource();e.connect(this.audio.destination),e.buffer=this.sounds.snap.buffer,e.start(0)}}},{key:"genImageParts",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.imageNumber=n||Math.ceil(150*Math.random()),this.imageParts.length=0;var s="./assets/img/box/".concat(this.imageNumber,".jpg"),i=new Image;i.onload=function(){for(var n=i.width/t.$app.config.columns,s=i.height/t.$app.config.rows,a=0;a<t.$app.config.rows;a++)for(var o=0;o<t.$app.config.columns;o++){var r=document.createElement("canvas"),l=r.getContext("2d");r.height="100",r.width="100",l.drawImage(i,o*n,a*s,n,s,0,0,r.width,r.height),t.imageParts.push(r)}e&&e()},i.src=s}},{key:"setGridContainerClass",value:function(e){var t=this.elements.grid.container.el,n=this.elements.grid.container.modifiers;Object.keys(n).forEach((function(n){t.classList[n==="container-".concat(e)?"add":"remove"](n)}))}}])&&o(t.prototype,n),a&&o(t,a),e}();function l(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.config=this.getConfigProxy({columns:4,rows:4,isSoundAllowed:!0,imagesInsteadNumbers:!0}),this.elements={container:{class:"puzzle__header",el:null},logo:{class:"puzzle__header-logo",el:null,text:"Gem puzzle"},settingsButton:{class:"puzzle__header-settings-toggle",el:null,click:this.toggle.bind(this)},settings:{container:{class:"puzzle__header-settings",el:null,modifiers:{show:"puzzle__header-settings--show"}},play:{container:{class:"puzzle__header-settings-line",el:null},button:{class:"puzzle__header-settings-line-button",el:null,text:"Start new game",click:function(){this.$app.game.id=Math.random(),this.$app.game.startNewGame(),this.toggle()}.bind(this)}},grid:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Field size:"},dropdown:{class:"puzzle__header-settings-line-dropdown",el:null,tag:"select",template:'\n              <option value=\'{"columns":3,"rows":3}\'>3x3</option>\n              <option value=\'{"columns":4,"rows":4}\'>4x4</option>\n              <option value=\'{"columns":5,"rows":5}\'>5x5</option>\n              <option value=\'{"columns":6,"rows":6}\'>6x6</option>\n              <option value=\'{"columns":7,"rows":7}\'>7x7</option>\n              <option value=\'{"columns":8,"rows":8}\'>8x8</option>',change:function(e){var t=JSON.parse(e.target.value);this.config.columns=t.columns,this.config.rows=t.rows}.bind(this)},subtext:{class:"puzzle__header-settings-line-subtext",el:null,text:"(need new game)"}},sound:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Sound active:"},checkbox:{class:"puzzle__header-settings-line-checkbox",el:null,template:'\n              <input type="checkbox" id="settings-sound" hidden>\n              <label for="settings-sound"></label>',click:function(e){var t=e.target.parentNode.children[0];t.checked=!t.checked,this.config.isSoundAllowed=t.checked}.bind(this)}},images:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Images instead numbers:"},checkbox:{class:"puzzle__header-settings-line-checkbox",el:null,template:'\n              <input type="checkbox" id="settings-images" hidden>\n              <label for="settings-images"></label>',click:function(e){var t=e.target.parentNode.children[0];t.checked=!t.checked,this.config.imagesInsteadNumbers=t.checked}.bind(this)}},records:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Table records:"},button:{class:"puzzle__header-settings-line-button",el:null,text:"show",click:this.$app.records.toggle.bind(this.$app.records)}},saves:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Saved games:"},button:{class:"puzzle__header-settings-line-button",el:null,text:"show",click:this.$app.saves.toggle.bind(this.$app.saves)}}}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){var e=this;this.$app.appendToMainContainer(s.getElementsByConfig(this.elements));var t=this.$app.storage.getSettings()||this.config;Object.keys(t).forEach((function(n){e.config[n]=t[n]}))}},{key:"getConfigProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,s){var i=e[n];return e[n]=s,t.$app.storage.saveSettings(),["columns","rows"].includes(n)&&(t.elements.settings.grid.dropdown.el.value=JSON.stringify({columns:e.columns,rows:e.rows})),"isSoundAllowed"===n&&(t.elements.settings.sound.checkbox.el.children[0].checked=e.isSoundAllowed),"imagesInsteadNumbers"===n&&(t.elements.settings.images.checkbox.el.children[0].checked=e.imagesInsteadNumbers,i!==s&&t.isShow&&(t.$app.storage.saveCurrentGame(),t.$app.storage.loadSavedGame(t.$app.game.grid.length?t.$app.game.id:null))),!0}})}},{key:"toggle",value:function(){this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){this.$app.game.isActive=!1,this.elements.settings.container.el.classList.add(this.elements.settings.container.modifiers.show)}},{key:"hide",value:function(){this.elements.settings.container.el.classList.remove(this.elements.settings.container.modifiers.show)}}])&&l(t.prototype,n),i&&l(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.keys={config:"__settings",save:"__savedGames",best:"__bestGames"}}var t,n,s;return t=e,(n=[{key:"toJson",value:function(e){return JSON.stringify(e)}},{key:"fromJson",value:function(e){return JSON.parse(e)}},{key:"getItem",value:function(e){try{return this.fromJson(localStorage.getItem(e))}catch(e){return null}}},{key:"setItem",value:function(e,t){localStorage.setItem(e,this.toJson(t))}},{key:"saveCurrentSettings",value:function(){this.setItem(this.keys.config,this.$app.config)}},{key:"getLoadedSettings",value:function(){return this.getItem(this.keys.config)}},{key:"getSavedGames",value:function(){return this.getItem(this.keys.save)||[]}},{key:"loadSavedGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.getSavedGames();(t=e?t.find((function(t){return t.game.id===e}))||!1:t[t.length-1]||!1)?(this.$app.game.id=t.game.id,this.$app.game.loadedData=t.game,this.$app.config.columns=t.config.columns,this.$app.config.rows=t.config.rows,this.$app.game.startNewGame()):this.$app.game.startNewGame()}},{key:"removeSavedGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=this.getSavedGames();t.forEach((function(n,s){n.game.id===e&&t.splice(s,1)})),this.setItem(this.keys.save,t)}}},{key:"saveCurrentGame",value:function(){var e=this.getItem(this.keys.save)||[],t={date:Date.now(),game:{id:this.$app.game.id,grid:this.$app.game.grid,stats:this.$app.game.stats,imageNumber:this.$app.game.imageNumber},config:{columns:this.$app.game.grid.length?this.$app.game.grid[0].length:0,rows:this.$app.game.grid.length,imagesInsteadNumbers:this.$app.config.imagesInsteadNumbers}},n=e.find((function(e){return e.game.id===t.game.id}))||!1;n?Object.assign(n,t):(e.length>7&&e.shift(),e.push(t)),e.sort((function(e,t){return e.date<t.date?-1:1})),this.setItem(this.keys.save,e)}},{key:"saveBestGames",value:function(){var e=this.getBestGames(),t={date:Date.now(),time:this.$app.game.getTimeString(),steps:this.$app.game.stats.steps};e||(e=[]);var n=e.findIndex((function(e){return e.steps>t.steps}));-1===n&&(n=e.length),e.splice(n,0,t),e.length>10&&(e.length=10),this.setItem(this.keys.best,e)}},{key:"getBestGames",value:function(){return this.getItem(this.keys.best)}},{key:"saveSettings",value:function(){this.setItem(this.keys.config,this.$app.config)}},{key:"getSettings",value:function(){return this.getItem(this.keys.config)}}])&&u(t.prototype,n),s&&u(t,s),e}();function m(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.elements={container:{class:"puzzle__popup puzzle__records",el:null,modifiers:{show:"puzzle__popup--show"}},header:{class:"puzzle__popup-header",el:null,text:"Best games"},list:{container:{class:"puzzle__popup-list",el:null},item:{skip:!0,container:{class:"puzzle__popup-list-item"},rank:{class:"puzzle__popup-list-item-rank"},date:{class:"puzzle__popup-list-item-date"},steps:{class:"puzzle__popup-list-item-steps",text:"steps: "},time:{class:"puzzle__popup-list-item-time",text:"time: "}}},close:{class:"puzzle__popup-button",el:null,text:"Close",click:function(){this.toggle()}.bind(this)}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){this.$app.appendToMainContainer(s.getElementsByConfig(this.elements))}},{key:"toggle",value:function(){this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){var e=this,t=this.$app.storage.getBestGames();t&&t.length?(this.elements.list.container.el.innerHTML="",t.forEach((function(t,n){e.elements.list.container.el.append(e.getBestGameElement(t,n))}))):this.elements.list.container.el.innerText="Finish one game",setTimeout((function(){e.elements.container.el.classList.add(e.elements.container.modifiers.show)}))}},{key:"hide",value:function(){this.elements.container.el.classList.remove(this.elements.container.modifiers.show)}},{key:"getBestGameElement",value:function(e,t){var n=this.elements.list.item,i=document.createElement("div");i.className=n.container.class;var a=document.createElement("div");a.className=n.rank.class,a.innerText=t+1;var o=document.createElement("div");o.className=n.date.class,o.innerText=s.getFullDateFromTimestamp(e.date);var r=document.createElement("div");r.className=n.steps.class,r.innerText="".concat(n.steps.text).concat(e.steps);var l=document.createElement("div");return l.className=n.time.class,l.innerText="".concat(n.time.text).concat(e.time),i.append(a),i.append(o),i.append(r),i.append(l),i}}])&&m(t.prototype,n),i&&m(t,i),e}();function g(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.elements={container:{class:"puzzle__popup puzzle__saves",el:null,modifiers:{show:"puzzle__popup--show"}},save:{class:"puzzle__popup-button",el:null,text:"Save current game",click:function(){this.$app.storage.saveCurrentGame(),this.show()}.bind(this)},list:{container:{class:"puzzle__popup-list",el:null},item:{skip:!0,container:{class:"puzzle__popup-list-item"},date:{class:"puzzle__popup-list-item-date"},field:{class:"puzzle__popup-list-item-field",text:"Field: "},actions:{container:{class:"puzzle__popup-list-item-actions"},load:{class:"puzzle__popup-list-item-load"},remove:{class:"puzzle__popup-list-item-remove"}}}},close:{class:"puzzle__popup-button",el:null,text:"Close",click:this.toggle.bind(this)}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){this.$app.appendToMainContainer(s.getElementsByConfig(this.elements))}},{key:"toggle",value:function(){this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){var e=this,t=this.$app.storage.getSavedGames();t&&t.length?(this.elements.list.container.el.innerHTML="",t.forEach((function(t){e.elements.list.container.el.append(e.createSaveElement(t))}))):this.elements.list.container.el.innerText="No data",setTimeout((function(){e.elements.container.el.classList.add(e.elements.container.modifiers.show)}))}},{key:"hide",value:function(){this.elements.container.el.classList.remove(this.elements.container.modifiers.show)}},{key:"createSaveElement",value:function(e){var t=this.elements.list.item,n=document.createElement("div");n.className=t.container.class;var i=document.createElement("div");i.className=t.date.class,i.innerText=s.getFullDateFromTimestamp(e.date)+(e.game.id===this.$app.game.id?" (current)":"");var a=document.createElement("div");a.className=t.field.class,a.innerText="".concat(t.field.text," ").concat(e.config.columns,"x").concat(e.config.rows);var o=document.createElement("div");o.className=t.actions.container.class;var r=document.createElement("div");r.className=t.actions.load.class,r.onclick=function(){this.$app.storage.loadSavedGame(e.game.id),this.toggle()}.bind(this);var l=document.createElement("div");return l.className=t.actions.remove.class,l.onclick=function(){this.$app.storage.removeSavedGame(e.game.id),this.show()}.bind(this),o.append(r),o.append(l),n.append(i),n.append(a),n.append(o),n}}])&&g(t.prototype,n),i&&g(t,i),e}();function f(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=new r(this),this.storage=new d(this),this.records=new h(this),this.saves=new p(this),this.settings=new c(this),this.config=this.settings.config,this.elements={container:{class:"puzzle",el:null},game:this.game.elements,settings:this.settings.elements,records:this.records.elements},window.addEventListener("beforeunload",this.storage.saveCurrentGame.bind(this.storage)),this.buildContainer(),this.settings.load(),this.storage.loadSavedGame(),this.records.load(),this.saves.load(),alert("По возможности проверьте в последний день дедлайна :)")}var t,n,s;return t=e,(n=[{key:"buildContainer",value:function(){this.elements.container.el=document.createElement("div"),this.elements.container.el.className=this.elements.container.class,document.body.append(this.elements.container.el)}},{key:"appendToMainContainer",value:function(e){this.elements.container.el.append(e)}}])&&f(t.prototype,n),s&&f(t,s),e}())}});