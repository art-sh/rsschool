!function(e){function t(t){for(var i,r,o=t[0],l=t[1],u=t[2],d=0,m=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&m.push(s[r][0]),s[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(c&&c(t);m.length;)m.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var l=n[o];0!==s[l]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},s={0:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var c=l;a.push([121,1]),n()}({121:function(e,t,n){n(122),e.exports=n(310)},309:function(e,t){e.exports='<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>Gem puzzle</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="preconnect" href="https://fonts.gstatic.com"> <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet"> </head> <body></body> </html>'},310:function(e,t,n){"use strict";n.r(t);n(309);function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var a={getElements:function(){return this.elements},getElementsByConfig:function(e){var t=this,n=null;return Object.keys(e).forEach((function(i){var s=e[i];if(!s.skip)if(s.container)n.append(t.getElementsByConfig(s));else{var a=document.createElement(s.tag||"div");s.el=a,function(e,t){var n=e;n.className=t.class,t.text&&(n.innerText=t.text),t.template&&(n.innerHTML=t.template),t.click&&n.addEventListener("click",t.click),t.change&&n.addEventListener("change",t.change)}(a,s),"container"===i?n=a:n.append(a)}})),n},getFullDateFromTimestamp:function(e){var t=new Date(e),n=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),a=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(i,"-").concat(s," ").concat(a,":").concat(r,":").concat(o)},getGridInitialByLength:function(e){var t=i(new Array(e).keys());return t.shift(),t.push(0),t},isGridSolvable:function(e){for(var t=0,n=1,i=e.length-1;n<i;n+=1)for(var s=n-1;s>=0;s-=1)e[s]>e[n]&&(t+=1);return!(t%2)},getElementCoordinatesAbsolute:function(e){return e.getBoundingClientRect()},toJson:function(e){return JSON.stringify(e)},fromJson:function(e){return JSON.parse(e)}};function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this.parent=i,this.matrix=t,this.dimension=t.length,this.h=0,this.zero={x:0,y:0},this.unique=this.matrix.toString(),this.matrix.forEach((function(e,t){e.forEach((function(e,i){if(e!==t*n.dimension+i+1)if(0===e)n.zero={x:i,y:t};else{var s=Math.floor((e-1)/n.dimension),a=e-1-s*n.dimension;n.h+=Math.abs(t-s)+Math.abs(i-a)}}))})),this.g=i?i.g+1:0,this.f=this.g+this.h}var t,n,i;return t=e,(n=[{key:"moveZero",value:function(t){var n=t.x,i=void 0===n?this.zero.x:n,s=t.y,a=void 0===s?this.zero.y:s;if(i<this.dimension&&a<this.dimension&&i>-1&&a>-1){var r=this.matrix.map((function(e){return e.slice()})),o=[r[a][i],r[this.zero.y][this.zero.x]];return r[this.zero.y][this.zero.x]=o[0],r[a][i]=o[1],new e(r,this)}return null}},{key:"nextStages",value:function(){var e=[];return e.push(this.moveZero({x:this.zero.x+1})),e.push(this.moveZero({y:this.zero.y+1})),e.push(this.moveZero({x:this.zero.x-1})),e.push(this.moveZero({y:this.zero.y-1})),e.filter((function(e){return null!==e}))}},{key:"isSolve",value:function(){return 0===this.h}},{key:"getUnique",value:function(){return this.unique}},{key:"print",value:function(){var e=[];return this.matrix.forEach((function(t){e.push(t.join("\t"))})),e.join("\n")}},{key:"printPretty",value:function(){var e=Math.floor(Math.log10(Math.pow(this.dimension,2)))+2,t=[];return this.matrix.forEach((function(n){t.push(n.reduce((function(t,n){return t+n.toString().padStart(e)}),""))})),t.join("\n")}}])&&o(t.prototype,n),i&&o(t,i),e}();function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=t,i=Array.from(new Array(Math.pow(e,2)-1),(function(e,t){return t+1}));i.push(0);for(var s=[],a=0;a<e;a+=1)s.push(i.slice(a*e,(a+1)*e));for(var r=new l(s);n>0;){var o=r.nextStages(),u=Math.floor(Math.random()*o.length);r=o[u],n-=1}return r}function c(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.closed=new Map,this.opened=new Map,this.length=t.matrix.length,this.opened.set(t.getUnique(),t)}var t,n,i;return t=e,(n=[{key:"getMin",value:function(){var e=this;return this.opened.get(c(this.opened.keys()).reduce((function(t,n){var i=e.opened.get(n).f;return i<t.min&&(t.min=i,t.key=n),t}),{min:1/0,key:null}).key)}},{key:"isSolveable",value:function(){var e=this.getMin(),t=e.getUnique().split(",").map((function(e){return+e})),n=e.zero.y+1;return t.forEach((function(e,i){if(0!==e)for(var s=i+1;s<t.length;s+=1)t[s]<e&&0!==t[s]&&(n+=1)})),n%2==0}},{key:"_getChain",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];e;)n.push(t?e.zero.y*e.dimension+e.zero.x+1:e.printPretty()),e=e.parent;return n.reverse()}},{key:"search",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(4===this.length&&!this.isSolveable())return null;for(;0!==this.opened.size;){var n=this.getMin();if(n.isSolve())return this._getChain(n,t);this.opened.delete(n.getUnique()),this.closed.set(n.getUnique(),n);var i=n.nextStages();i.forEach((function(t){if(!e.closed.has(t.getUnique())){var n=e.opened.get(t.getUnique());n?t.g<n.g&&e.opened.set(t.getUnique(),t):e.opened.set(t.getUnique(),t)}}))}return null}}])&&m(t.prototype,n),i&&m(t,i),e}();function g(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,a),this.$app=t,this.id=Math.random(),this.loadedData=null,this.grid=[],this.gridInitial=[],this.gridElements=[],this.gridElementExample={id:null,element:null},this.stats=this.getStatsProxy({minutes:0,seconds:0,steps:0}),this.elements={container:{class:"puzzle__game",el:null,modifiers:{draggable:"puzzle__game--draggable"}},grid:{container:{class:"puzzle__game-grid",el:null,modifiers:{"container-9":"puzzle__game-grid--grid9","container-16":"puzzle__game-grid--grid16","container-25":"puzzle__game-grid--grid25","container-36":"puzzle__game-grid--grid36","container-49":"puzzle__game-grid--grid49","container-64":"puzzle__game-grid--grid64"}},item:{class:"puzzle__game-grid-item"},button:{class:"puzzle__game-grid-item-button",modifiers:{active:"puzzle__game-grid-item-button--active",inactive:"puzzle__game-grid-item-button--inactive",draggable:"puzzle__game-grid-item-button--draggable"}}},stats:{container:{class:"puzzle__game-stats",el:null},time:{class:"puzzle__game-stats-time",el:null,text:"Time:"},steps:{class:"puzzle__game-stats-steps",el:null,text:"Steps:"}}},this.audio=new(window.AudioContext||window.webkitAudioContext),this.sounds={snap:{src:"assets/sounds/snap.mp3",buffer:null}},this.imageNumber=null,this.imageParts=[],this.isBuilded=!1,this.isMoving=!1,this.isActive=!1,this.isGameEnded=!1,this.loadSounds()}var t,n,i;return t=e,(n=[{key:"getRandomGrid",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=t;if(!n)do{n=new u(this.$app.config.columns,75).matrix}while(a.isGridSolvable(n));var i=0;this.grid.length=0,n.forEach((function(t){e.grid.push(t),i+=t.length})),this.gridInitial=a.getGridInitialByLength(i)}},{key:"getGridAsArray",value:function(){return this.grid.reduce((function(e,t){return e.push.apply(e,g(t)),e}),[])}},{key:"buildGameContainer",value:function(){this.elements.container.el=document.createElement("div"),this.elements.container.el.className=this.elements.container.class,this.buildControlsContainer(),this.buildGridContainer(),this.$app.appendToMainContainer(this.elements.container.el)}},{key:"buildGridContainer",value:function(){var e=this;this.elements.grid.container.el=document.createElement("div"),this.elements.grid.container.el.className=this.elements.grid.container.class,this.elements.container.el.append(this.elements.grid.container.el),setTimeout((function(){e.setGridListeners()}))}},{key:"buildGridItems",value:function(e){var t=this;this.gridElements.length=0,this.elements.grid.container.el.innerHTML="",this.getRandomGrid(e),this.getGridAsArray().forEach((function(e){var n=t.generateGridItem(e);t.gridElements.push(n),t.elements.grid.container.el.append(n.element.parentNode)})),this.sortGridElements()}},{key:"generateGridItem",value:function(e){var t=JSON.parse(JSON.stringify(this.gridElementExample)),n=document.createElement("div");n.className=this.elements.grid.item.class;var i=document.createElement("div");return i.innerText=e?e.toString():"",this.$app.config.imagesInsteadNumbers&&e&&(i=this.imageParts[e]),i.className=this.elements.grid.button.class,e||i.classList.add(this.elements.grid.button.modifiers.inactive),n.append(i),t.id=e,t.element=i,t}},{key:"setGridListeners",value:function(){var e=this;this.elements.grid.container.el.addEventListener("mousedown",(function(t){if(!e.isGameEnded&&!e.isMoving){var n=t.target;n.classList.contains(e.elements.grid.item.class)&&(n=n.querySelector(".".concat(e.elements.grid.button.class)));var i=e.getElementConfigByNode(n);if(n.classList.contains(e.elements.grid.button.modifiers.active)&&i){e.isActive||(e.isActive=!0,e.startListenGameTime());var s={element:n,coords:a.getElementCoordinatesAbsolute(n),mouse:{x:t.x,y:t.y}},r=e;s.element.ontransitionend=function(t){t.target.classList.remove(e.elements.grid.button.modifiers.draggable),setTimeout((function(){e.isMoving=!1})),e.handleSuccessEnd(),t.target.ontransitionend=null};var o,l=(o=null,function(t){o&&(clearTimeout(o),o=null),o=setTimeout((function(){(function(t){if(!(Math.abs(s.mouse.x-t.x)<25&&Math.abs(s.mouse.y-t.y)<25)){r.elements.container.el.classList.add(r.elements.container.modifiers.draggable),r.isMoving=!0;var n={x:t.x-s.coords.left-(s.coords.right-s.coords.left)/2,y:t.y-s.coords.top-(s.coords.bottom-s.coords.top)/2};s.element.style.transition="unset",s.element.style.transform="translate(".concat(n.x,"px, ").concat(n.y,"px)"),s.element.classList.add(e.elements.grid.button.modifiers.draggable)}}).call(r,t),o=null}))});document.addEventListener("mousemove",l),document.addEventListener("mouseup",(function t(n){setTimeout((function(){e.elements.container.el.classList.remove(e.elements.container.modifiers.draggable),setTimeout((function(){if(n.target.classList.contains(e.elements.grid.button.modifiers.inactive)){var t=e.getElementConfigByNode(n.target),a=e.getElementConfigByNode(s.element),r=e.getElementCoordinatesByID(t.id),o=e.getElementCoordinatesByID(a.id);e.moveElementTo(o,r)}e.isMoving||e.moveElementTo(e.getElementCoordinatesByID(i.id),e.getElementCoordinatesAvailable(i.id)),setTimeout((function(){s.element.removeAttribute("style")}))}))})),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",t)}))}}}))}},{key:"getElementCoordinatesByPosition",value:function(e){var t=Math.floor(e/this.$app.config.columns);return{x:e-t*this.$app.config.columns,y:t}}},{key:"getElementCoordinatesByID",value:function(e){try{return this.grid.forEach((function(t,n){t.forEach((function(t,i){if(t===e)throw new Error(JSON.stringify({x:i,y:n}))}))})),null}catch(e){return JSON.parse(e.message)}}},{key:"getElementCoordinatesAvailable",value:function(e){var t=this.getElementCoordinatesByID(e);return this.grid[t.y]&&0===this.grid[t.y][t.x+1]?{x:t.x+1,y:t.y}:this.grid[t.y]&&0===this.grid[t.y][t.x-1]?{x:t.x-1,y:t.y}:this.grid[t.y+1]&&0===this.grid[t.y+1][t.x]?{x:t.x,y:t.y+1}:!(!this.grid[t.y-1]||0!==this.grid[t.y-1][t.x])&&{x:t.x,y:t.y-1}}},{key:"getElementConfigByNode",value:function(e){return this.gridElements.reduce((function(t,n){return n.element===e?n:t}),null)}},{key:"getNodeByCoordinates",value:function(e,t){return this.elements.grid.container.el.children[e+t*this.$app.config.rows].children[0]||null}},{key:"sortGridElements",value:function(){var e=this;this.grid.reduce((function(e,t){return e.push.apply(e,g(t)),e}),[]).forEach((function(t){var n=e.gridElements.find((function(e){return e.id===t})),i=e.getElementCoordinatesByID(t),s=e.getNodeByCoordinates(i.x,i.y);n.element.classList[e.isMoveAvailable(t)?"add":"remove"](e.elements.grid.button.modifiers.active),s!==n.element&&(e.switchNodes(n.element,e.getElementConfigByNode(s).element),e.isActive&&(e.stats.steps+=1))}))}},{key:"isMoveAvailable",value:function(e){return!1!==this.getElementCoordinatesAvailable(e)}},{key:"moveElementTo",value:function(e,t){var n=this.grid[e.y][e.x];this.grid[e.y][e.x]=this.grid[t.y][t.x],this.grid[t.y][t.x]=n,this.sortGridElements()}},{key:"switchNodes",value:function(e,t){var n=this,i=e,s=t,r=e.parentNode,o=t.parentNode,l=a.getElementCoordinatesAbsolute(e),u=a.getElementCoordinatesAbsolute(t);r.innerHTML="",o.innerHTML="",r.append(t),o.append(e),i.style.transition="unset",i.classList.contains(this.elements.grid.button.modifiers.inactive)||(i.style.transform="translate(".concat(l.x-u.x,"px, ").concat(l.y-u.y,"px)")),s.style.transition="unset",s.classList.contains(this.elements.grid.button.modifiers.inactive)||(s.style.transform="translate(".concat(u.x-l.x,"px, ").concat(u.y-l.y,"px)")),setTimeout((function(){n.playSound(),e.removeAttribute("style"),t.removeAttribute("style")}))}},{key:"isGameComplete",value:function(){return JSON.stringify(this.gridInitial)===JSON.stringify(this.grid.reduce((function(e,t){return e.push.apply(e,g(t)),e}),[]))}},{key:"handleSuccessEnd",value:function(){var e=this;!this.isGameEnded&&this.isGameComplete()&&(this.isActive=!1,this.isGameEnded=!0,this.$app.storage.saveBestGames(),setTimeout((function(){alert("Ура! Вы решили головоломку за ".concat(e.getTimeString()," и ").concat(e.stats.steps," ходов"))})))}},{key:"startNewGame",value:function(){var e=this;this.isBuilded||(this.buildGameContainer(),this.isBuilded=!0),this.setGridContainerClass(this.$app.config.rows*this.$app.config.columns),this.elements.grid.container.el.style.transition="unset",this.elements.grid.container.el.style.opacity="0";var t=this.loadedData?this.loadedData.imageNumber:null;this.genImageParts((function(){e.loadedData?(e.buildGridItems(e.loadedData.grid),e.stats.minutes=e.loadedData.stats.minutes||0,e.stats.seconds=e.loadedData.stats.seconds||0,e.stats.steps=e.loadedData.stats.steps||0):(e.buildGridItems(),e.id=Math.random(),e.stats.minutes=0,e.stats.seconds=0,e.stats.steps=0),setTimeout((function(){e.elements.grid.container.el.removeAttribute("style")})),e.isMoving=!1,e.isActive=!1,e.isGameEnded=e.isGameComplete(),e.loadedData=null}),t)}},{key:"autoFinishGame",value:function(){var e=this;if(4!==this.$app.config.columns)return alert("Available only for 4x4");this.isGameEnded=!0,this.isActive=!1;var t=this.getSolution();return t?(function t(n){var i=n.shift(),s=e.getElementCoordinatesByID(0),r=e.getElementCoordinatesByPosition(i);e.moveElementTo(s,r),setTimeout((function(){return n.length?t(n):!a.isGridSolvable(e.grid)||alert("This game is not counted because you use hints")}),550)}(t),!0):(this.isGameEnded=!1,alert("Solution not found"))}},{key:"getSolution",value:function(){var e=new l(this.grid),t=new h(e).search(!0);return t?(t.shift(),t.map((function(e){return e-1}))):null}},{key:"buildControlsContainer",value:function(){var e=this;this.elements.stats.container.el=document.createElement("div"),this.elements.stats.container.el.className=this.elements.stats.container.class,this.elements.container.el.append(this.elements.stats.container.el),Object.keys(this.elements.stats).forEach((function(t){"container"!==t&&(e.elements.stats[t].el=document.createElement("div"),e.elements.stats[t].el.className=e.elements.stats[t].class,e.elements.stats.container.el.append(e.elements.stats[t].el))}))}},{key:"getStatsProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,i){return e[n]=i,["minutes","seconds"].includes(n)?t.elements.stats.time.el.innerText="".concat(t.elements.stats.time.text," ").concat(t.getTimeString()):"steps"===n&&(t.elements.stats.steps.el.innerText="".concat(t.elements.stats.steps.text," ").concat(i.toString())),!0}})}},{key:"startListenGameTime",value:function(){var e=this;setTimeout((function(){e.isActive&&(e.stats.seconds+=1,60===e.stats.seconds&&(e.stats.minutes+=1,e.stats.seconds=0),e.startListenGameTime())}),1e3-(new Date).getMilliseconds())}},{key:"getTimeString",value:function(){return"".concat(this.stats.minutes.toString().padStart(2,"0"),":").concat(this.stats.seconds.toString().padStart(2,"0"))}},{key:"loadSounds",value:function(){var e=this;Object.keys(this.sounds).forEach((function(t){fetch(e.sounds[t].src).then((function(e){return e.arrayBuffer()})).then((function(n){return e.audio.decodeAudioData(n,(function(n){e.sounds[t].buffer=n}))}))}))}},{key:"playSound",value:function(){if(this.$app.config.isSoundAllowed){var e=this.audio.createBufferSource();e.connect(this.audio.destination),e.buffer=this.sounds.snap.buffer,e.start(0)}}},{key:"genImageParts",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.imageNumber=n||Math.ceil(150*Math.random()),this.imageParts.length=0;var i="./assets/img/box/".concat(this.imageNumber,".jpg"),s=new Image;s.onload=function(){for(var n=s.width/t.$app.config.columns,i=s.height/t.$app.config.rows,a=0;a<t.$app.config.rows;a+=1)for(var r=0;r<t.$app.config.columns;r+=1){var o=document.createElement("canvas"),l=o.getContext("2d");o.height="100",o.width="100",l.drawImage(s,r*n,a*i,n,i,0,0,o.width,o.height),t.imageParts.push(o)}return e&&e()},s.src=i}},{key:"setGridContainerClass",value:function(e){var t=this.elements.grid.container.el,n=this.elements.grid.container.modifiers;Object.keys(n).forEach((function(n){t.classList[n==="container-".concat(e)?"add":"remove"](n)}))}}])&&f(t.prototype,n),i&&f(t,i),e}();function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.config=this.getConfigProxy({columns:4,rows:4,isSoundAllowed:!0,imagesInsteadNumbers:!0}),this.elements={container:{class:"puzzle__header",el:null},logo:{class:"puzzle__header-logo",el:null,text:"Gem puzzle"},settingsButton:{class:"puzzle__header-settings-toggle",el:null,click:this.toggle.bind(this)},settings:{container:{class:"puzzle__header-settings",el:null,modifiers:{show:"puzzle__header-settings--show"}},play:{container:{class:"puzzle__header-settings-line",el:null},button:{class:"puzzle__header-settings-line-button",el:null,text:"Start new game",click:function(){this.$app.game.id=Math.random(),this.$app.game.startNewGame(),this.toggle()}.bind(this)}},autoFinish:{container:{class:"puzzle__header-settings-line",el:null},button:{class:"puzzle__header-settings-line-button",el:null,text:"Auto finish current game",click:function(){this.$app.game.autoFinishGame(),this.toggle()}.bind(this)},subtext:{class:"puzzle__header-settings-line-subtext",el:null,text:"(4x4)"}},grid:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Field size:"},dropdown:{class:"puzzle__header-settings-line-dropdown",el:null,tag:"select",template:'\n              <option value=\'{"columns":3,"rows":3}\'>3x3</option>\n              <option value=\'{"columns":4,"rows":4}\'>4x4</option>\n              <option value=\'{"columns":5,"rows":5}\'>5x5</option>\n              <option value=\'{"columns":6,"rows":6}\'>6x6</option>\n              <option value=\'{"columns":7,"rows":7}\'>7x7</option>\n              <option value=\'{"columns":8,"rows":8}\'>8x8</option>',change:function(e){var t=JSON.parse(e.target.value);this.config.columns=t.columns,this.config.rows=t.rows}.bind(this)},subtext:{class:"puzzle__header-settings-line-subtext",el:null,text:"(need new game)"}},sound:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Sound active:"},checkbox:{class:"puzzle__header-settings-line-checkbox",el:null,template:'\n              <input type="checkbox" id="settings-sound" hidden>\n              <label for="settings-sound"></label>',click:function(e){var t=e.target.parentNode.children[0];t.checked=!t.checked,this.config.isSoundAllowed=t.checked}.bind(this)}},images:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Images instead numbers:"},checkbox:{class:"puzzle__header-settings-line-checkbox",el:null,template:'\n              <input type="checkbox" id="settings-images" hidden>\n              <label for="settings-images"></label>',click:function(e){var t=e.target.parentNode.children[0];t.checked=!t.checked,this.config.imagesInsteadNumbers=t.checked}.bind(this)}},records:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Table records:"},button:{class:"puzzle__header-settings-line-button",el:null,text:"show",click:this.$app.records.toggle.bind(this.$app.records)}},saves:{container:{class:"puzzle__header-settings-line",el:null},text:{class:"puzzle__header-settings-line-text",el:null,text:"Saved games:"},button:{class:"puzzle__header-settings-line-button",el:null,text:"show",click:this.$app.saves.toggle.bind(this.$app.saves)}}}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){var e=this;this.$app.appendToMainContainer(a.getElementsByConfig(this.elements));var t=this.$app.storage.getSettings()||this.config;Object.keys(t).forEach((function(n){e.config[n]=t[n]}))}},{key:"getConfigProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,n,i){var s=e[n],a=e;return a[n]=i,t.$app.storage.saveSettings(),["columns","rows"].includes(n)&&(t.elements.settings.grid.dropdown.el.value=JSON.stringify({columns:a.columns,rows:a.rows})),"isSoundAllowed"===n&&(t.elements.settings.sound.checkbox.el.children[0].checked=a.isSoundAllowed),"imagesInsteadNumbers"===n&&(t.elements.settings.images.checkbox.el.children[0].checked=a.imagesInsteadNumbers,s!==i&&t.isShow&&(t.$app.storage.saveCurrentGame(),t.$app.storage.loadSavedGame(t.$app.game.grid.length?t.$app.game.id:null))),!0}})}},{key:"toggle",value:function(){return this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){this.$app.game.isActive=!1,this.elements.settings.container.el.classList.add(this.elements.settings.container.modifiers.show)}},{key:"hide",value:function(){this.elements.settings.container.el.classList.remove(this.elements.settings.container.modifiers.show)}}])&&y(t.prototype,n),i&&y(t,i),e}();function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.storage=localStorage,this.keys={config:"__settings",save:"__savedGames",best:"__bestGames"}}var t,n,i;return t=e,(n=[{key:"getItem",value:function(e){try{return a.fromJson(this.storage.getItem(e))}catch(e){return null}}},{key:"setItem",value:function(e,t){this.storage.setItem(e,a.toJson(t))}},{key:"saveCurrentSettings",value:function(){this.setItem(this.keys.config,this.$app.config)}},{key:"getLoadedSettings",value:function(){return this.getItem(this.keys.config)}},{key:"getSavedGames",value:function(){return this.getItem(this.keys.save)||[]}},{key:"loadSavedGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.getSavedGames();(t=e?t.find((function(t){return t.game.id===e}))||!1:t[t.length-1]||!1)?(this.$app.game.id=t.game.id,this.$app.game.loadedData=t.game,this.$app.config.columns=t.config.columns,this.$app.config.rows=t.config.rows,this.$app.game.startNewGame()):this.$app.game.startNewGame()}},{key:"removeSavedGame",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=this.getSavedGames();t.forEach((function(n,i){n.game.id===e&&t.splice(i,1)})),this.setItem(this.keys.save,t)}}},{key:"saveCurrentGame",value:function(){var e=this.getItem(this.keys.save)||[],t={date:Date.now(),game:{id:this.$app.game.id,grid:this.$app.game.grid,stats:this.$app.game.stats,imageNumber:this.$app.game.imageNumber},config:{columns:this.$app.game.grid.length?this.$app.game.grid[0].length:0,rows:this.$app.game.grid.length,imagesInsteadNumbers:this.$app.config.imagesInsteadNumbers}},n=e.find((function(e){return e.game.id===t.game.id}))||!1;n?Object.assign(n,t):(e.length>7&&e.shift(),e.push(t)),e.sort((function(e,t){return e.date<t.date?-1:1})),this.setItem(this.keys.save,e)}},{key:"saveBestGames",value:function(){var e=this.getBestGames(),t={date:Date.now(),time:this.$app.game.getTimeString(),steps:this.$app.game.stats.steps};e||(e=[]);var n=e.findIndex((function(e){return e.steps>t.steps}));-1===n&&(n=e.length),e.splice(n,0,t),e.length>10&&(e.length=10),this.setItem(this.keys.best,e)}},{key:"getBestGames",value:function(){return this.getItem(this.keys.best)}},{key:"saveSettings",value:function(){this.setItem(this.keys.config,this.$app.config)}},{key:"getSettings",value:function(){return this.getItem(this.keys.config)}}])&&w(t.prototype,n),i&&w(t,i),e}();function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.elements={container:{class:"puzzle__popup puzzle__records",el:null,modifiers:{show:"puzzle__popup--show"}},header:{class:"puzzle__popup-header",el:null,text:"Best games"},list:{container:{class:"puzzle__popup-list",el:null},item:{skip:!0,container:{class:"puzzle__popup-list-item"},rank:{class:"puzzle__popup-list-item-rank"},date:{class:"puzzle__popup-list-item-date"},steps:{class:"puzzle__popup-list-item-steps",text:"steps: "},time:{class:"puzzle__popup-list-item-time",text:"time: "}}},close:{class:"puzzle__popup-button",el:null,text:"Close",click:function(){this.toggle()}.bind(this)}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){this.$app.appendToMainContainer(a.getElementsByConfig(this.elements))}},{key:"toggle",value:function(){return this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){var e=this,t=this.$app.storage.getBestGames();t&&t.length?(this.elements.list.container.el.innerHTML="",t.forEach((function(t,n){e.elements.list.container.el.append(e.getBestGameElement(t,n))}))):this.elements.list.container.el.innerText="Finish one game",setTimeout((function(){e.elements.container.el.classList.add(e.elements.container.modifiers.show)}))}},{key:"hide",value:function(){this.elements.container.el.classList.remove(this.elements.container.modifiers.show)}},{key:"getBestGameElement",value:function(e,t){var n=this.elements.list.item,i=document.createElement("div");i.className=n.container.class;var s=document.createElement("div");s.className=n.rank.class,s.innerText=t+1;var r=document.createElement("div");r.className=n.date.class,r.innerText=a.getFullDateFromTimestamp(e.date);var o=document.createElement("div");o.className=n.steps.class,o.innerText="".concat(n.steps.text).concat(e.steps);var l=document.createElement("div");return l.className=n.time.class,l.innerText="".concat(n.time.text).concat(e.time),i.append(s),i.append(r),i.append(o),i.append(l),i}}])&&x(t.prototype,n),i&&x(t,i),e}();function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$app=t,this.elements={container:{class:"puzzle__popup puzzle__saves",el:null,modifiers:{show:"puzzle__popup--show"}},save:{class:"puzzle__popup-button",el:null,text:"Save current game",click:function(){this.$app.storage.saveCurrentGame(),this.show()}.bind(this)},list:{container:{class:"puzzle__popup-list",el:null},item:{skip:!0,container:{class:"puzzle__popup-list-item"},date:{class:"puzzle__popup-list-item-date"},field:{class:"puzzle__popup-list-item-field",text:"Field: "},actions:{container:{class:"puzzle__popup-list-item-actions"},load:{class:"puzzle__popup-list-item-load"},remove:{class:"puzzle__popup-list-item-remove"}}}},close:{class:"puzzle__popup-button",el:null,text:"Close",click:this.toggle.bind(this)}},this.isShow=!1}var t,n,i;return t=e,(n=[{key:"load",value:function(){this.$app.appendToMainContainer(a.getElementsByConfig(this.elements))}},{key:"toggle",value:function(){return this.isShow=!this.isShow,this.isShow?this.show():this.hide()}},{key:"show",value:function(){var e=this,t=this.$app.storage.getSavedGames();t&&t.length?(this.elements.list.container.el.innerHTML="",t.forEach((function(t){e.elements.list.container.el.append(e.createSaveElement(t))}))):this.elements.list.container.el.innerText="No data",setTimeout((function(){e.elements.container.el.classList.add(e.elements.container.modifiers.show)}))}},{key:"hide",value:function(){this.elements.container.el.classList.remove(this.elements.container.modifiers.show)}},{key:"createSaveElement",value:function(e){var t=this.elements.list.item,n=document.createElement("div");n.className=t.container.class;var i=document.createElement("div");i.className=t.date.class,i.innerText=a.getFullDateFromTimestamp(e.date)+(e.game.id===this.$app.game.id?" (current)":"");var s=document.createElement("div");s.className=t.field.class,s.innerText="".concat(t.field.text," ").concat(e.config.columns,"x").concat(e.config.rows);var r=document.createElement("div");r.className=t.actions.container.class;var o=document.createElement("div");o.className=t.actions.load.class,o.onclick=function(){this.$app.storage.loadSavedGame(e.game.id),this.toggle()}.bind(this);var l=document.createElement("div");return l.className=t.actions.remove.class,l.onclick=function(){this.$app.storage.removeSavedGame(e.game.id),this.show()}.bind(this),r.append(o),r.append(l),n.append(i),n.append(s),n.append(r),n}}])&&k(t.prototype,n),i&&k(t,i),e}();function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=new v(this),this.storage=new z(this),this.records=new _(this),this.saves=new S(this),this.settings=new b(this),this.config=this.settings.config,this.elements={container:{class:"puzzle",el:null},game:this.game.elements,settings:this.settings.elements,records:this.records.elements}}var t,n,i;return t=e,(n=[{key:"init",value:function(){window.addEventListener("beforeunload",this.storage.saveCurrentGame.bind(this.storage)),this.buildContainer(),this.settings.load(),this.storage.loadSavedGame(),this.records.load(),this.saves.load()}},{key:"buildContainer",value:function(){this.elements.container.el=document.createElement("div"),this.elements.container.el.className=this.elements.container.class,document.body.append(this.elements.container.el)}},{key:"appendToMainContainer",value:function(e){this.elements.container.el.append(e)}}])&&E(t.prototype,n),i&&E(t,i),e}())).init()}});